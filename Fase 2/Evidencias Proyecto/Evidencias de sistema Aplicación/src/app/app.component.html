<ion-app>
  <a class="skip-to-content" href="#main-content">Saltar al contenido principal</a>
  <ion-menu contentId="main-content">
    <ion-content>
      <div class="menu-header">
        <div class="menu-header-content">
          <ion-avatar class="profile-avatar">
            <img [src]="(user$ | async)?.profileImageUrl || 'assets/imgs/paw.png'" alt="Foto de perfil" loading="lazy">
          </ion-avatar>
          <ion-label>
            <h2>{{ (user$ | async)?.nombreCompleto || 'Usuario' }}</h2>
            <p>{{ (user$ | async)?.email || '' }}</p>
            <p class="user-role">{{ (user$ | async)?.role | userRoleTranslate }}</p>
          </ion-label>
        </div>
        <!-- Theme Toggle Button -->
        <div class="menu-header-actions">
          <app-theme-toggle></app-theme-toggle>
        </div>
      </div>

      <ng-container *ngIf="menuStats$ | async as stats">
        <section class="quick-actions" aria-label="Panel rápido de estado">
          <button class="quick-card" type="button" (click)="navigateTo('/user/notifications')">
            <span class="quick-value">{{ stats.unreadNotifications }}</span>
            <span class="quick-label">Notificaciones</span>
          </button>
          <button class="quick-card" type="button" (click)="navigateTo('/adoptions/received-requests')">
            <span class="quick-value">{{ stats.pendingOwnerRequests }}</span>
            <span class="quick-label">Solicitudes recibidas</span>
          </button>
          <button class="quick-card" type="button" (click)="navigateTo('/adoptions/my-adoptions')">
            <span class="quick-value">{{ stats.pendingApplicantRequests }}</span>
            <span class="quick-label">Solicitudes enviadas</span>
          </button>
          <button class="quick-card" type="button" (click)="navigateTo('/appointments')">
            <span class="quick-value">{{ stats.upcomingAppointments }}</span>
            <span class="quick-label">Próximas citas</span>
          </button>
        </section>

        <ion-accordion-group expand="compact" multiple="true" class="menu-accordion-group"
          [value]="['explore', 'adoptions']">
          <ion-accordion value="explore" toggle-icon="chevron-down-outline" toggle-icon-slot="end">
            <ion-item lines="none" slot="header" class="menu-accordion-header">
              <ion-label>Explorar</ion-label>
            </ion-item>
            <ion-list slot="content">
              <ion-item button (click)="navigateTo('/pets/home')" [class.selected]="isSelected('/pets/home')"
                [attr.aria-current]="isSelected('/pets/home') ? 'page' : null">
                <ion-icon name="home-outline" slot="start"></ion-icon>
                <ion-label>
                  <span class="menu-item-title">Inicio</span>
                  <span class="menu-item-subtitle">Recomendaciones y búsqueda</span>
                </ion-label>
              </ion-item>
              <ion-item button (click)="goToProfile()" [class.selected]="isSelected('/perfil/' + (user$ | async)?.uid)"
                [attr.aria-current]="isSelected('/perfil/' + (user$ | async)?.uid) ? 'page' : null">
                <ion-icon name="person-circle-outline" slot="start"></ion-icon>
                <ion-label>
                  <span class="menu-item-title">Mi Perfil</span>
                  <span class="menu-item-subtitle">Configura tu información pública</span>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-accordion>

          <ion-item button (click)="navigateTo('/user/notifications')" [class.selected]="isSelected('/user/notifications')"
            [attr.aria-current]="isSelected('/user/notifications') ? 'page' : null">
            <ion-icon name="notifications-outline" slot="start"></ion-icon>
            <ion-label>
              <span class="menu-item-title">Notificaciones</span>
              <span class="menu-item-subtitle">Alertas y seguimiento</span>
            </ion-label>
            <ion-badge *ngIf="stats.unreadNotifications" color="danger">{{ stats.unreadNotifications }}</ion-badge>
          </ion-item>

          <ion-item button (click)="navigateTo('/adoptions/my-adoptions')" [class.selected]="isSelected('/adoptions/my-adoptions')"
            [attr.aria-current]="isSelected('/adoptions/my-adoptions') ? 'page' : null">
            <ion-icon name="paper-plane-outline" slot="start"></ion-icon>
            <ion-label>
              <span class="menu-item-title">Mis Solicitudes</span>
              <span class="menu-item-subtitle">Historial y estado</span>
            </ion-label>
            <ion-badge *ngIf="stats.pendingApplicantRequests" color="warning">{{ stats.pendingApplicantRequests
              }}</ion-badge>
          </ion-item>
          <ion-item button (click)="navigateTo('/adoptions/received-requests')"
            [class.selected]="isSelected('/adoptions/received-requests')"
            [attr.aria-current]="isSelected('/adoptions/received-requests') ? 'page' : null">
            <ion-icon name="mail-open-outline" slot="start"></ion-icon>
            <ion-label>
              <span class="menu-item-title">Solicitudes Recibidas</span>
              <span class="menu-item-subtitle">Adoptantes en espera</span>
            </ion-label>
            <ion-badge *ngIf="stats.pendingOwnerRequests" color="success">{{ stats.pendingOwnerRequests
              }}</ion-badge>
          </ion-item>
          <ion-item button (click)="navigateTo('/adoptions/adopted-pets')"
            [class.selected]="isSelected('/adoptions/adopted-pets')"
            [attr.aria-current]="isSelected('/adoptions/adopted-pets') ? 'page' : null">
            <ion-icon name="heart-circle-outline" slot="start"></ion-icon>
            <ion-label>
              <span class="menu-item-title">Mascotas Adoptadas</span>
              <span class="menu-item-subtitle">Seguimiento de entregas</span>
            </ion-label>
          </ion-item>
          <ion-item *ngIf="(isAuthenticated$ | async)" button (click)="navigateTo('/reports/my-reports')"
            [class.selected]="isSelected('/reports/my-reports')"
            [attr.aria-current]="isSelected('/reports/my-reports') ? 'page' : null">
            <ion-icon name="flag-outline" slot="start"></ion-icon>
            <ion-label>
              <span class="menu-item-title">Mis Reportes</span>
              <span class="menu-item-subtitle">Alertas y seguimientos</span>
            </ion-label>
          </ion-item>

          <ion-accordion *ngIf="(user$ | async)?.isAdmin || (user$ | async)?.isVeterinarian" value="special"
            toggle-icon="chevron-down-outline" toggle-icon-slot="end">
            <ion-item lines="none" slot="header" class="menu-accordion-header">
              <ion-label>Perfiles especializados</ion-label>
            </ion-item>
            <ion-list slot="content">
              <ion-item *ngIf="(user$ | async)?.isAdmin" button (click)="navigateTo('/admin')"
                [class.selected]="isSelected('/admin')" [attr.aria-current]="isSelected('/admin') ? 'page' : null">
                <ion-icon name="shield-checkmark-outline" slot="start"></ion-icon>
                <ion-label>
                  <span class="menu-item-title">Panel Administrador</span>
                  <span class="menu-item-subtitle">Moderación y reportes</span>
                </ion-label>
              </ion-item>
              <ion-item *ngIf="(user$ | async)?.isVeterinarian" button (click)="navigateTo('/veterinarian/dashboard')"
                [class.selected]="isSelected('/veterinarian/dashboard')"
                [attr.aria-current]="isSelected('/veterinarian/dashboard') ? 'page' : null">
                <ion-icon name="medical-outline" slot="start"></ion-icon>
                <ion-label>
                  <span class="menu-item-title">Panel Veterinario</span>
                  <span class="menu-item-subtitle">Agenda y casos clínicos</span>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-accordion>

          <ion-accordion value="tools" toggle-icon="chevron-down-outline" toggle-icon-slot="end">
            <ion-item lines="none" slot="header" class="menu-accordion-header">
              <ion-label>Herramientas</ion-label>
            </ion-item>
            <ion-list slot="content">
              <ion-item button (click)="navigateTo('/appointments')" [class.selected]="isSelected('/appointments')"
                [attr.aria-current]="isSelected('/appointments') ? 'page' : null">
                <ion-icon name="calendar-outline" slot="start"></ion-icon>
                <ion-label>
                  <span class="menu-item-title">Mis Citas</span>
                  <span class="menu-item-subtitle">Agenda y recordatorios</span>
                </ion-label>
                <ion-badge *ngIf="stats.upcomingAppointments" color="tertiary">{{ stats.upcomingAppointments
                  }}</ion-badge>
              </ion-item>
              <ion-item button (click)="navigateTo('/pets/crear')" [class.selected]="isSelected('/pets/crear')"
                [attr.aria-current]="isSelected('/pets/crear') ? 'page' : null">
                <ion-icon name="add-circle-outline" slot="start"></ion-icon>
                <ion-label>
                  <span class="menu-item-title">Crear Adopción</span>
                  <span class="menu-item-subtitle">Publica una nueva mascota</span>
                </ion-label>
              </ion-item>
              <ion-item button (click)="logout()">
                <ion-icon name="log-out-outline" slot="start"></ion-icon>
                <ion-label>
                  <span class="menu-item-title">Cerrar Sesión</span>
                  <span class="menu-item-subtitle">Salir de tu cuenta</span>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-accordion>
        </ion-accordion-group>
      </ng-container>
    </ion-content>
  </ion-menu>

  <ion-router-outlet id="main-content"></ion-router-outlet>
</ion-app>
