<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/pets/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Notificaciones</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="markAllAsRead()">
        <ion-icon name="checkmark-done-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Filter Chips -->
  <ion-toolbar>
    <ion-segment [(ngModel)]="selectedFilter" mode="md" scrollable>
      <ion-segment-button *ngFor="let filter of filterOptions" [value]="filter.value">
        <ion-icon [name]="filter.icon" class="segment-icon"></ion-icon>
        <ion-label>{{ filter.label }}</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="$event.target.complete()">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="notifications-container">
    <!-- Empty State -->
    <div class="empty-state" *ngIf="((notifications$ | async) | notificationFilter:selectedFilter)?.length === 0">
      <ion-icon [name]="selectedFilter === 'unread' ? 'mail-unread-outline' : 'notifications-off-outline'"></ion-icon>
      <p *ngIf="selectedFilter === 'all'">No tienes notificaciones</p>
      <p *ngIf="selectedFilter === 'unread'">No tienes notificaciones sin leer</p>
      <p *ngIf="selectedFilter === 'adoption'">No tienes notificaciones de adopción</p>
      <p *ngIf="selectedFilter === 'appointment'">No tienes notificaciones de citas</p>
    </div>

    <!-- Notifications List -->
    <ion-list class="notifications-list"
      *ngIf="((notifications$ | async) | notificationFilter:selectedFilter)?.length > 0">
      <ion-item-sliding *ngFor="let notification of (notifications$ | async) | notificationFilter:selectedFilter">
        <ion-item (click)="onNotificationClick(notification)" [class.unread]="!notification.read" detail="false" button
          class="notification-item">

          <!-- Priority Indicator -->
          <div *ngIf="notification.priority === 'urgent' || notification.priority === 'high'" class="priority-indicator"
            [class.urgent]="notification.priority === 'urgent'" [class.high]="notification.priority === 'high'">
          </div>

          <div class="notification-icon-wrapper" [ngClass]="notification.type" slot="start">
            <ion-icon *ngIf="notification.type === 'adoption_request'" name="paw"></ion-icon>
            <ion-icon *ngIf="notification.type === 'adoption_approved'" name="checkmark-circle"
              color="success"></ion-icon>
            <ion-icon *ngIf="notification.type === 'adoption_rejected'" name="close-circle" color="danger"></ion-icon>
            <ion-icon
              *ngIf="notification.type === 'appointment' || notification.type === 'appointment_request' || notification.type === 'appointment_update'"
              name="calendar"></ion-icon>
            <ion-icon *ngIf="notification.type === 'message'" name="chatbubble"></ion-icon>
            <ion-icon *ngIf="notification.type === 'general' || !notification.type" name="notifications"></ion-icon>
            <ion-icon *ngIf="notification.type === 'system'" name="information-circle"></ion-icon>
            <ion-icon *ngIf="notification.type === 'vaccination_reminder'" name="medkit"></ion-icon>
            <ion-icon *ngIf="notification.type === 'pet_birthday'" name="gift"></ion-icon>
          </div>

          <!-- Pet Image Preview -->
          <div *ngIf="notification.imageUrl" class="notification-thumbnail" slot="start">
            <img [src]="notification.imageUrl" [alt]="notification.title" loading="lazy">
          </div>

          <ion-label>
            <div class="notification-header">
              <h2>{{ notification.title || 'Notificación' }}</h2>
              <span class="time">{{ notification.createdAt | timeAgo }}</span>
            </div>
            <p class="notification-body">{{ notification.body }}</p>
          </ion-label>

          <div class="notification-badges" slot="end">
            <ion-chip *ngIf="notification.priority === 'urgent'" color="danger" class="priority-chip">
              ¡Urgente!
            </ion-chip>
            <div class="unread-badge" *ngIf="!notification.read"></div>
            <ion-button fill="clear" size="small" (click)="deleteNotification(notification, $event)" class="delete-btn">
              <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
            </ion-button>
          </div>
        </ion-item>

        <!-- Swipe Options -->
        <ion-item-options side="end">
          <ion-item-option color="danger" (click)="deleteNotification(notification)">
            <ion-icon slot="icon-only" name="trash"></ion-icon>
          </ion-item-option>
        </ion-item-options>

        <ion-item-options side="start">
          <ion-item-option color="primary" (click)="onNotificationClick(notification)">
            <ion-icon slot="icon-only" name="eye"></ion-icon>
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
    </ion-list>
  </div>
</ion-content>