<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="cancel()" class="close-button">
        <ion-icon slot="icon-only" name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title class="modal-title">Agendar Cita Veterinaria</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="appointment-content">
  <!-- Pet Info Banner -->
  <div class="pet-banner">
    <div class="pet-info-container">
      <ion-icon name="paw-outline" class="pet-icon"></ion-icon>
      <div class="pet-text">
        <h2>{{ mascota.nombre }}</h2>
        <p>{{ mascota.tipoMascota }} - {{ mascota.tamano }}</p>
      </div>
    </div>
  </div>

  <form [formGroup]="appointmentForm" (ngSubmit)="scheduleAppointment()" class="appointment-form">
    
    <!-- Veterinarian Selection -->
    <div class="form-section">
      <div class="section-header">
        <ion-icon name="person-circle-outline"></ion-icon>
        <h3>Selecciona Veterinario</h3>
      </div>
      
      <ion-item class="vet-select-item" lines="none">
        <ion-label position="floating">Veterinario</ion-label>
        <ion-select formControlName="vetId" required class="vet-select">
          <ion-select-option *ngFor="let vet of veterinarians" [value]="vet.uid">
            {{ vet.nombreCompleto }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      
      <div class="error-message" *ngIf="appointmentForm.get('vetId')?.touched && appointmentForm.get('vetId')?.invalid">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <span>Debes seleccionar un veterinario</span>
      </div>
    </div>

    <!-- Date and Time Section -->
    <div class="form-section">
      <div class="section-header">
        <ion-icon name="calendar-outline"></ion-icon>
        <h3>Fecha y Hora</h3>
      </div>
      
      <div class="date-time-container">
        <ion-item class="date-time-item" lines="none">
          <ion-label position="floating">Fecha</ion-label>
          <ion-input 
            formControlName="date" 
            type="date" 
            [min]="minDate"
            required
            class="date-input">
          </ion-input>
        </ion-item>

        <ion-item class="date-time-item" lines="none">
          <ion-label position="floating">Hora</ion-label>
          <ion-input 
            formControlName="time" 
            type="time"
            required
            class="time-input">
          </ion-input>
        </ion-item>
      </div>

      <div class="error-message" *ngIf="appointmentForm.get('date')?.touched && appointmentForm.get('date')?.invalid">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <span>Selecciona una fecha válida</span>
      </div>

      <div class="error-message" *ngIf="appointmentForm.get('time')?.touched && appointmentForm.get('time')?.invalid">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <span>Selecciona una hora válida</span>
      </div>
    </div>

    <!-- Reason Section -->
    <div class="form-section">
      <div class="section-header">
        <ion-icon name="document-text-outline"></ion-icon>
        <h3>Razón de la Consulta</h3>
      </div>
      
      <ion-item class="textarea-item" lines="none">
        <ion-label position="floating">¿Cuál es el motivo de la consulta?</ion-label>
        <ion-textarea 
          formControlName="reason"
          class="reason-textarea"
          rows="3"
          required
          placeholder="Describe los síntomas o razón de la visita...">
        </ion-textarea>
      </ion-item>

      <div class="character-count">
        <span>{{ appointmentForm.get('reason')?.value?.length || 0 }}/100 caracteres</span>
      </div>

      <div class="error-message" *ngIf="appointmentForm.get('reason')?.touched && appointmentForm.get('reason')?.hasError('required')">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <span>La razón de la consulta es requerida</span>
      </div>
      <div class="error-message" *ngIf="appointmentForm.get('reason')?.touched && appointmentForm.get('reason')?.hasError('minlength')">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <span>Mínimo 10 caracteres</span>
      </div>
    </div>

    <!-- Notes Section (Optional) -->
    <div class="form-section">
      <div class="section-header">
        <ion-icon name="information-circle-outline"></ion-icon>
        <h3>Información Adicional <span class="optional-badge">Opcional</span></h3>
      </div>
      
      <ion-item class="textarea-item" lines="none">
        <ion-label position="floating">Notas o datos importantes</ion-label>
        <ion-textarea 
          formControlName="notes"
          class="notes-textarea"
          rows="2"
          placeholder="Alergias, medicinas actuales, cirugías previas...">
        </ion-textarea>
      </ion-item>

      <div class="character-count">
        <span>{{ appointmentForm.get('notes')?.value?.length || 0 }}/500 caracteres</span>
      </div>

      <div class="error-message" *ngIf="appointmentForm.get('notes')?.touched && appointmentForm.get('notes')?.hasError('maxlength')">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <span>Máximo 500 caracteres</span>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="button-group">
      <ion-button 
        expand="full" 
        type="submit" 
        [disabled]="!appointmentForm.valid || isLoading"
        color="success"
        class="submit-button">
        <ion-spinner *ngIf="isLoading" name="crescent" class="button-spinner"></ion-spinner>
        <span *ngIf="!isLoading">
          <ion-icon slot="start" name="checkmark-circle"></ion-icon>
          Agendar Cita
        </span>
      </ion-button>
      
      <ion-button 
        expand="full" 
        (click)="cancel()"
        fill="outline"
        color="medium"
        [disabled]="isLoading"
        class="cancel-button">
        <ion-icon slot="start" name="close-circle"></ion-icon>
        Cancelar
      </ion-button>
    </div>
  </form>
</ion-content>
