<ion-header class="ion-no-border">
  <ion-toolbar class="header-toolbar">
    <ion-title class="header-title">
      <div class="title-content">
        <ion-icon name="clipboard-outline" class="title-icon"></ion-icon>
        <span>Cuestionario de Adopción</span>
      </div>
      <div class="subtitle">{{ request.requester.name }}</div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="closeModal()" class="close-button">
        <ion-icon name="close-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="questionnaire-container">
    
    <!-- Pet Preview Card -->
    <div class="pet-preview-card" [@fadeInUp]>
      <div class="pet-image-container">
        <img [src]="request.pet?.imageUrl || 'assets/images/default-pet.png'" 
             [alt]="request.pet?.name" 
             class="pet-image">
        <div class="pet-type-badge">
          <ion-icon [name]="request.pet?.type === 'dog' ? 'paw' : 'fish'"></ion-icon>
          <span>{{ request.pet?.type === 'dog' ? 'Perro' : 'Gato' }}</span>
        </div>
      </div>
      <div class="pet-info">
        <h2 class="pet-name">{{ request.pet?.name }}</h2>
        <p class="pet-breed" *ngIf="request.pet?.breed">{{ request.pet?.breed }}</p>
        <div class="request-meta">
          <div class="meta-item">
            <ion-icon name="calendar-outline"></ion-icon>
            <span>{{ getFormattedDate(request.requestDate) }}</span>
          </div>
          <div class="meta-item">
            <ion-icon name="time-outline"></ion-icon>
            <span>{{ getTimeAgo(request.requestDate) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Compatibility Score -->
    <div class="compatibility-section" [@fadeInUp]>
      <div class="score-header">
        <ion-icon name="analytics-outline" class="score-icon"></ion-icon>
        <h3>Puntuación de Compatibilidad</h3>
      </div>
      <div class="score-display">
        <div class="score-circle" [class.excellent]="compatibilityScore >= 80" 
                                   [class.good]="compatibilityScore >= 60 && compatibilityScore < 80"
                                   [class.fair]="compatibilityScore >= 40 && compatibilityScore < 60"
                                   [class.poor]="compatibilityScore < 40">
          <span class="score-number">{{ compatibilityScore }}</span>
          <span class="score-total">/100</span>
        </div>
        <div class="score-details">
          <div class="score-label" [class.excellent]="compatibilityScore >= 80" 
                                   [class.good]="compatibilityScore >= 60 && compatibilityScore < 80"
                                   [class.fair]="compatibilityScore >= 40 && compatibilityScore < 60"
                                   [class.poor]="compatibilityScore < 40">
            {{ getScoreLabel() }}
          </div>
          <div class="score-description">{{ getScoreDescription() }}</div>
          <div class="score-breakdown">
            <div class="breakdown-item" *ngFor="let item of scoreBreakdown">
              <ion-icon [name]="item.icon" [color]="item.points > 0 ? 'success' : 'danger'"></ion-icon>
              <span>{{ item.label }}</span>
              <span class="points" [class.positive]="item.points > 0" [class.negative]="item.points < 0">
                {{ item.points > 0 ? '+' : '' }}{{ item.points }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Visual Alerts -->
    <div class="alerts-section" *ngIf="alerts.length > 0" [@fadeInUp]>
      <div class="alert-item" *ngFor="let alert of alerts" [class]="'alert-' + alert.type">
        <ion-icon [name]="alert.icon" class="alert-icon"></ion-icon>
        <div class="alert-content">
          <div class="alert-title">{{ alert.title }}</div>
          <div class="alert-message">{{ alert.message }}</div>
        </div>
      </div>
    </div>
    
    <!-- Vivienda y Seguridad -->
    <div class="section" [@fadeInUp]>
      <div class="section-header">
        <ion-icon name="home" class="section-icon"></ion-icon>
        <h3 class="section-title">Vivienda y Seguridad</h3>
      </div>
      
      <div class="question-card">
        <div class="question-item">
          <ion-icon name="business-outline" class="question-icon"></ion-icon>
          <div class="question-content">
            <div class="question">¿Vives en casa propia o alquilada?</div>
            <div class="answer">
              <ion-chip [color]="request.housingType === 'own' ? 'success' : 'primary'" class="answer-chip">
                <ion-icon [name]="request.housingType === 'own' ? 'checkmark-circle' : 'home'"></ion-icon>
                <ion-label>{{ request.housingType === 'own' ? 'Propia' : 'Alquilada' }}</ion-label>
              </ion-chip>
            </div>
          </div>
        </div>

        <div class="question-item">
          <ion-icon name="leaf-outline" class="question-icon"></ion-icon>
          <div class="question-content">
            <div class="question">¿Jardín o balcón cercado/asegurado?</div>
            <div class="answer">
              <ion-chip [color]="request.secureFencing ? 'success' : 'medium'" class="answer-chip">
                <ion-icon [name]="request.secureFencing ? 'checkmark-circle' : 'close-circle'"></ion-icon>
                <ion-label>{{ request.secureFencing ? 'Sí' : 'No' }}</ion-label>
              </ion-chip>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Estilo de Vida -->
    <div class="section" [@fadeInUp]>
      <div class="section-header">
        <ion-icon name="calendar" class="section-icon"></ion-icon>
        <h3 class="section-title">Estilo de Vida</h3>
      </div>
      
      <div class="question-card">
        <div class="question-item">
          <ion-icon name="location-outline" class="question-icon"></ion-icon>
          <div class="question-content">
            <div class="question">¿Dónde vivirá la mascota?</div>
            <div class="answer">{{ getSpaceText(request.petLivingSpace) }}</div>
          </div>
        </div>

        <div class="question-item">
          <ion-icon name="time-outline" class="question-icon"></ion-icon>
          <div class="question-content">
            <div class="question">¿Horas que pasará solo?</div>
            <div class="answer">
              <ion-badge color="warning">{{ request.hoursAlone || 'No especificado' }} horas</ion-badge>
            </div>
          </div>
        </div>

        <div class="question-item">
          <ion-icon name="people-outline" class="question-icon"></ion-icon>
          <div class="question-content">
            <div class="question">Miembros del hogar:</div>
            <div class="answer">{{ request.householdMembers || 'Solo yo' }}</div>
          </div>
        </div>

        <div class="question-item">
          <ion-icon name="medical-outline" class="question-icon"></ion-icon>
          <div class="question-content">
            <div class="question">¿Alguien con alergias?</div>
            <div class="answer">
              <ion-chip [color]="getAllergiesColor(request.allergies)" class="answer-chip">
                <ion-icon [name]="getAllergiesIcon(request.allergies)"></ion-icon>
                <ion-label>{{ getAllergiesText(request.allergies) }}</ion-label>
              </ion-chip>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Experiencia -->
    <div class="section" [@fadeInUp]>
      <div class="section-header">
        <ion-icon name="ribbon" class="section-icon"></ion-icon>
        <h3 class="section-title">Experiencia</h3>
      </div>
      
      <div class="question-card">
        <div class="question-item">
          <ion-icon name="paw-outline" class="question-icon"></ion-icon>
          <div class="question-content">
            <div class="question">¿Has tenido mascotas antes?</div>
            <div class="answer">
              <ion-chip [color]="request.previousExperience ? 'success' : 'medium'" class="answer-chip">
                <ion-icon [name]="request.previousExperience ? 'checkmark-circle' : 'close-circle'"></ion-icon>
                <ion-label>{{ request.previousExperience ? 'Sí' : 'No' }}</ion-label>
              </ion-chip>
            </div>
          </div>
        </div>

        <div class="question-item experience-detail" *ngIf="request.previousExperienceDetails">
          <ion-icon name="document-text-outline" class="question-icon"></ion-icon>
          <div class="question-content">
            <div class="question">Detalles de experiencia previa:</div>
            <div class="answer detail-box">{{ request.previousExperienceDetails }}</div>
          </div>
        </div>

        <div class="question-item">
          <ion-icon name="paw" class="question-icon"></ion-icon>
          <div class="question-content">
            <div class="question">¿Tienes otras mascotas actualmente?</div>
            <div class="answer">
              <ion-chip [color]="request.otherPets ? 'tertiary' : 'medium'" class="answer-chip">
                <ion-icon [name]="request.otherPets ? 'checkmark-circle' : 'close-circle'"></ion-icon>
                <ion-label>{{ request.otherPets ? 'Sí' : 'No' }}</ion-label>
              </ion-chip>
            </div>
          </div>
        </div>

        <div class="question-item experience-detail" *ngIf="request.otherPetsDetails">
          <ion-icon name="document-text-outline" class="question-icon"></ion-icon>
          <div class="question-content">
            <div class="question">Detalles sobre otras mascotas:</div>
            <div class="answer detail-box">{{ request.otherPetsDetails }}</div>
          </div>
        </div>

        <div class="question-item">
          <ion-icon name="fitness-outline" class="question-icon"></ion-icon>
          <div class="question-content">
            <div class="question">¿Acceso a veterinario?</div>
            <div class="answer">
              <ion-chip [color]="request.veterinaryAccess ? 'success' : 'danger'" class="answer-chip">
                <ion-icon [name]="request.veterinaryAccess ? 'checkmark-circle' : 'close-circle'"></ion-icon>
                <ion-label>{{ request.veterinaryAccess ? 'Sí' : 'No' }}</ion-label>
              </ion-chip>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Compromiso a Largo Plazo -->
    <div class="section" *ngIf="request.longTermCommitment" [@fadeInUp]>
      <div class="section-header">
        <ion-icon name="heart-circle" class="section-icon"></ion-icon>
        <h3 class="section-title">Compromiso</h3>
      </div>
      
      <div class="question-card">
        <div class="question-item">
          <ion-icon name="heart-outline" class="question-icon"></ion-icon>
          <div class="question-content">
            <div class="question">Compromiso a largo plazo:</div>
            <div class="answer detail-box commitment-box">{{ request.longTermCommitment }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Comentarios adicionales -->
    <div class="section" *ngIf="request.adminNotes" [@fadeInUp]>
      <div class="section-header">
        <ion-icon name="chatbox-ellipses" class="section-icon"></ion-icon>
        <h3 class="section-title">Comentarios adicionales</h3>
      </div>
      
      <div class="additional-notes">
        <ion-icon name="information-circle-outline" class="note-icon"></ion-icon>
        <div class="note-content">{{ request.adminNotes }}</div>
      </div>
    </div>

  </div>
</ion-content>

<!-- Secondary Actions -->
<div class="secondary-actions" *ngIf="request.status === 'pending'" [@fadeInUp]>
  <ion-button fill="clear" size="small" (click)="contactApplicant()">
    <ion-icon name="chatbubble-ellipses-outline" slot="start"></ion-icon>
    Contactar
  </ion-button>
  <ion-button fill="clear" size="small" (click)="requestMoreInfo()">
    <ion-icon name="information-circle-outline" slot="start"></ion-icon>
    Solicitar más info
  </ion-button>
  <ion-button fill="clear" size="small" (click)="viewApplicantProfile()">
    <ion-icon name="person-outline" slot="start"></ion-icon>
    Ver perfil
  </ion-button>
</div>

<!-- Action Buttons -->
<ion-footer *ngIf="request.status === 'pending'">
  <ion-toolbar>
    <div class="quick-responses" *ngIf="showQuickResponses">
      <div class="quick-response-header">
        <span>Razón del rechazo:</span>
        <ion-button fill="clear" size="small" (click)="showQuickResponses = false">
          <ion-icon name="close" slot="icon-only"></ion-icon>
        </ion-button>
      </div>
      <ion-button 
        *ngFor="let reason of rejectReasons" 
        expand="block" 
        fill="outline" 
        size="small"
        (click)="respondWithReason('reject', reason)">
        {{ reason }}
      </ion-button>
    </div>
    
    <div class="action-buttons" [class.hidden]="showQuickResponses">
      <ion-button 
        expand="block" 
        fill="outline" 
        color="danger" 
        (click)="showRejectOptions()">
        <ion-icon name="close-circle-outline" slot="start"></ion-icon>
        Rechazar
      </ion-button>
      
      <ion-button 
        expand="block" 
        fill="solid" 
        color="success" 
        (click)="showApprovalConfirmation()">
        <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
        Aprobar
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>