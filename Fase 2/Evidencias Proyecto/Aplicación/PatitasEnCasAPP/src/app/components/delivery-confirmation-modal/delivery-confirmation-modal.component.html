<ion-header>
  <ion-toolbar class="header-toolbar">
    <ion-title class="header-title">
      Confirmación de Entrega
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cancel()" class="close-button">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="confirmation-container">
    
    <!-- Header Info -->
    <ion-card class="info-card">
      <ion-card-content>
        <div class="pet-info">
          <ion-icon name="paw" color="primary"></ion-icon>
          <div>
            <h2>{{ pet.nombre }}</h2>
            <p class="role-badge" [class.owner-badge]="userRole === 'owner'" [class.adopter-badge]="userRole === 'adopter'">
              {{ userRole === 'owner' ? 'Dueño Original' : 'Adoptante' }}
            </p>
          </div>
        </div>
        
        <div class="parties-info">
          <div class="party">
            <ion-icon name="person-circle" color="primary"></ion-icon>
            <div>
              <p class="party-label">Dueño Original</p>
              <p class="party-name">{{ ownerName }}</p>
            </div>
          </div>
          <ion-icon name="arrow-forward" color="medium"></ion-icon>
          <div class="party">
            <ion-icon name="heart-circle" color="primary"></ion-icon>
            <div>
              <p class="party-label">Adoptante</p>
              <p class="party-name">{{ adopterName }}</p>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Delivery Location -->
    <div class="form-section">
      <h3>
        <ion-icon name="location"></ion-icon>
        Lugar de Entrega *
      </h3>
      <ion-item lines="none" class="input-item">
        <ion-textarea
          [(ngModel)]="deliveryLocation"
          placeholder="Ej: Parque Central, Ciudad"
          rows="2"
          [disabled]="isSubmitting"
        ></ion-textarea>
      </ion-item>
    </div>

    <!-- Delivery Checklist -->
    <div class="form-section">
      <h3>
        <ion-icon name="checkbox-outline"></ion-icon>
        Lista de Verificación
      </h3>
      <ion-list class="checklist">
        <ion-item lines="none">
          <ion-checkbox slot="start" [(ngModel)]="checklist.pet" [disabled]="isSubmitting"></ion-checkbox>
          <ion-label>
            <h4>Mascota en buen estado de salud *</h4>
            <p>La mascota se ve saludable y activa</p>
          </ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-checkbox slot="start" [(ngModel)]="checklist.vaccinationCard" [disabled]="isSubmitting"></ion-checkbox>
          <ion-label>
            <h4>Carnet de vacunación *</h4>
            <p>Carnet de vacunas actualizado</p>
          </ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-checkbox slot="start" [(ngModel)]="checklist.medicalDocuments" [disabled]="isSubmitting"></ion-checkbox>
          <ion-label>
            <h4>Documentos médicos *</h4>
            <p>Historial médico, recetas, etc.</p>
          </ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-checkbox slot="start" [(ngModel)]="checklist.food" [disabled]="isSubmitting"></ion-checkbox>
          <ion-label>
            <h4>Alimento</h4>
            <p>Comida y porciones recomendadas</p>
          </ion-label>
        </ion-item>

        <ion-item lines="none">
          <ion-checkbox slot="start" [(ngModel)]="checklist.accessories" [disabled]="isSubmitting"></ion-checkbox>
          <ion-label>
            <h4>Accesorios</h4>
            <p>Correa, collar, juguetes, cama, etc.</p>
          </ion-label>
        </ion-item>
      </ion-list>

      <ion-chip *ngIf="allChecklistValid" color="success">
        <ion-icon name="checkmark-circle"></ion-icon>
        <ion-label>Lista completa</ion-label>
      </ion-chip>
    </div>

    <!-- Delivery Notes -->
    <div class="form-section">
      <h3>
        <ion-icon name="document-text"></ion-icon>
        Notas Adicionales
      </h3>
      <ion-item lines="none" class="input-item">
        <ion-textarea
          [(ngModel)]="deliveryNotes"
          placeholder="Cualquier información adicional sobre la entrega..."
          rows="4"
          [disabled]="isSubmitting"
        ></ion-textarea>
      </ion-item>
    </div>

    <!-- Photos (Optional) -->
    <div class="form-section">
      <h3>
        <ion-icon name="camera"></ion-icon>
        Fotos de la Entrega (Opcional)
      </h3>
      
      <div class="photo-actions">
        <ion-button fill="outline" (click)="takePhoto()" [disabled]="isSubmitting">
          <ion-icon name="camera" slot="start"></ion-icon>
          Tomar Foto
        </ion-button>
        <ion-button fill="outline" (click)="selectFromGallery()" [disabled]="isSubmitting">
          <ion-icon name="images" slot="start"></ion-icon>
          Galería
        </ion-button>
      </div>

      <div class="photo-grid" *ngIf="deliveryPhotos.length > 0">
        <div class="photo-item" *ngFor="let photo of deliveryPhotos; let i = index">
          <img [src]="photo" alt="Foto de entrega">
          <ion-button 
            fill="clear" 
            class="remove-photo-btn" 
            (click)="removePhoto(i)"
            [disabled]="isSubmitting"
          >
            <ion-icon name="close-circle" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>

    <!-- Legal Notice -->
    <ion-card class="legal-notice">
      <ion-card-content>
        <ion-icon name="information-circle" color="primary"></ion-icon>
        <div>
          <h4>Confirmación Legal</h4>
          <p>
            Al confirmar, certifico que {{ userRole === 'owner' ? 'he entregado' : 'he recibido' }} 
            físicamente a <strong>{{ pet.nombre }}</strong> y que toda la información proporcionada 
            es verídica. Esta confirmación forma parte de un documento legal.
          </p>
        </div>
      </ion-card-content>
    </ion-card>

  </div>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-button 
      expand="block" 
      (click)="confirmDelivery()"
      [disabled]="!isFormValid() || isSubmitting"
      color="primary"
      class="confirm-btn"
    >
      <ion-icon name="checkmark-circle" slot="start"></ion-icon>
      Confirmar Entrega
    </ion-button>
  </ion-toolbar>
</ion-footer>
