<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin/reports"></ion-back-button>
    </ion-buttons>
    <ion-title>Detalles del Reporte</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div *ngIf="report">
    <ion-card>
      <ion-card-header>
        <ion-card-title>{{ report.petSnapshot?.nombre || 'Mascota Eliminada/No Encontrada' }}</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item>
            <ion-label>Reportado por:</ion-label>
            <ion-note slot="end">{{ report.reporter?.nombreCompleto || 'Usuario Eliminado/No Encontrado' }}</ion-note>
          </ion-item>
          <ion-item>
            <ion-label>Publicador:</ion-label>
            <ion-note slot="end">{{ report.publisher?.nombreCompleto || 'Usuario Eliminado/No Encontrado' }}</ion-note>
          </ion-item>
          <ion-item>
            <ion-label>Motivo:</ion-label>
            <ion-note slot="end">{{ report.reason }}</ion-note>
          </ion-item>
          <ion-item *ngIf="report.details">
            <ion-label>Detalles:</ion-label>
            <ion-note slot="end">{{ report.details }}</ion-note>
          </ion-item>
          <ion-item>
            <ion-label>Fecha:</ion-label>
            <ion-note slot="end">{{ report.createdAt | date:'medium' }}</ion-note>
          </ion-item>
          <ion-item>
            <ion-label>Estado:</ion-label>
            <ion-chip slot="end" [color]="report.status === 'pending' ? 'warning' : report.status === 'reviewed' ? 'primary' : report.status === 'resolved' ? 'success' : report.status === 'rejected' ? 'danger' : 'medium'">
              <ion-label>{{ getSpanishStatus(report.status) | titlecase }}</ion-label>
            </ion-chip>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <ion-list>
      <ion-list-header>
        <ion-label>Acciones</ion-label>
      </ion-list-header>

      <ion-item button (click)="markAsReviewed()" *ngIf="report.status === 'pending'">
        <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
        <ion-label>Marcar como Revisado</ion-label>
      </ion-item>

      <ion-item button (click)="banUser(report.reporterId)" *ngIf="report.reporter?.uid">
        <ion-icon name="ban-outline" slot="start"></ion-icon>
        <ion-label>Banear Reportador</ion-label>
      </ion-item>

      <ion-item button (click)="banUser(report.publisher.uid)" *ngIf="report.publisher?.uid">
        <ion-icon name="ban-outline" slot="start"></ion-icon>
        <ion-label>Banear Publicador</ion-label>
      </ion-item>

      <ion-item>
        <ion-label>Cambiar Estado</ion-label>
        <ion-select interface="popover" (ionChange)="updateReportStatus($event.detail.value)">
          <ion-select-option value="pending">Pendiente</ion-select-option>
          <ion-select-option value="reviewed">Revisado</ion-select-option>
          <ion-select-option value="resolved">Resuelto</ion-select-option>
          <ion-select-option value="rejected">Rechazado</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item button (click)="deletePet()" *ngIf="report.petId">
        <ion-icon name="trash-bin-outline" slot="start" color="danger"></ion-icon>
        <ion-label color="danger">Eliminar Mascota</ion-label>
      </ion-item>

      <ion-item button (click)="deleteReport()">
        <ion-icon name="trash-outline" slot="start" color="danger"></ion-icon>
        <ion-label color="danger">Eliminar Reporte</ion-label>
      </ion-item>
    </ion-list>
  </div>
</ion-content>
