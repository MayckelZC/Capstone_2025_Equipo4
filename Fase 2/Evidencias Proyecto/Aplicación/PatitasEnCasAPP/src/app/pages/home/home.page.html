<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button aria-label="Abrir menú de navegación"></ion-menu-button>
    </ion-buttons>
    <ion-title>PatitasEnCasa</ion-title>
    <ion-buttons slot="end">


    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Hero Section Dinámico -->
  <div class="hero-section">
    <div class="hero-background"></div>
    <div class="hero-content">
      <div class="hero-stats" role="status" aria-live="polite" aria-atomic="true">
        <div class="stat-item">
          <span class="stat-number">{{ animatedStats.totalPets }}</span>
          <span class="stat-label">Disponibles</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ animatedStats.totalAdoptions }}</span>
          <span class="stat-label">{{ getAdoptionsLabel() }}</span>
        </div>
        <div class="stat-item" *ngIf="homeStats.totalShelters > 0">
          <span class="stat-number">{{ animatedStats.totalShelters }}</span>
          <span class="stat-label">Refugios</span>
        </div>
      </div>
      <p class="sr-only" aria-live="polite" aria-atomic="true">{{ heroStatsAnnouncement }}</p>
      
      <h1 class="hero-title">
        <span class="animated-text">Encuentra a tu nuevo</span>
        <span class="highlight-text">mejor amigo</span>
      </h1>
      
      <p class="hero-subtitle">Cada mascota merece un hogar lleno de amor</p>
      
      <!-- Búsqueda Mejorada -->
      <div class="search-container">
        <ion-searchbar 
          [(ngModel)]="searchTerm" 
          (ionInput)="filterPets()" 
          placeholder="Buscar por nombre, ciudad o personalidad"
          class="enhanced-search"
          aria-label="Buscar mascotas por nombre, raza o personalidad">
        </ion-searchbar>
        <ion-button 
          (click)="openFilterModal()" 
          fill="clear" 
          class="filter-button"
          aria-label="Abrir filtros avanzados">
          <ion-icon name="options-outline" aria-hidden="true"></ion-icon>
        </ion-button>
      </div>
    </div>
  </div>

  <!-- Filtros Visuales Mejorados -->
  <div class="modern-filters">
    <div class="filters-header">
      <h3>Explora por Categoría</h3>
      <ion-button 
        fill="clear" 
        size="small" 
        (click)="clearAllFilters()"
        *ngIf="hasActiveFilters()"
        aria-label="Limpiar todos los filtros">
        Limpiar
      </ion-button>
    </div>
    
    <div class="filter-cards" role="radiogroup" aria-label="Filtros por tipo de mascota">
      <button 
        type="button"
        class="filter-card" 
        [class.active]="selectedFilter === 'all'"
        (click)="setFilter('all')"
        role="radio"
        [attr.aria-checked]="selectedFilter === 'all'"
        [attr.aria-label]="getFilterDescription('all')">
        <div class="filter-icon all">
          <ion-icon name="paw" aria-hidden="true"></ion-icon>
        </div>
        <span class="filter-label">Todos</span>
        <span class="filter-count" aria-hidden="true">{{ allAdopciones.length }}</span>
      </button>
      
      <button 
        type="button"
        class="filter-card" 
        [class.active]="selectedFilter === 'perro'"
        (click)="setFilter('perro')"
        role="radio"
        [attr.aria-checked]="selectedFilter === 'perro'"
        [attr.aria-label]="getFilterDescription('perro')">
        <div class="filter-icon dog">
          <img src="assets/imgs/dog-icon.svg" alt="" class="custom-pet-icon" aria-hidden="true">
        </div>
        <span class="filter-label">Perros</span>
        <span class="filter-count" aria-hidden="true">{{ getFilteredCount('perro') }}</span>
      </button>
      
      <button 
        type="button"
        class="filter-card" 
        [class.active]="selectedFilter === 'gato'"
        (click)="setFilter('gato')"
        role="radio"
        [attr.aria-checked]="selectedFilter === 'gato'"
        [attr.aria-label]="getFilterDescription('gato')">
        <div class="filter-icon cat">
          <img src="assets/imgs/cat-icon.svg" alt="" class="custom-pet-icon" aria-hidden="true">
        </div>
        <span class="filter-label">Gatos</span>
        <span class="filter-count" aria-hidden="true">{{ getFilteredCount('gato') }}</span>
      </button>
      
      <button 
        type="button"
        class="filter-card" 
        [class.active]="selectedFilter === 'favoritos'"
        (click)="setFilter('favoritos')"
        role="radio"
        [attr.aria-checked]="selectedFilter === 'favoritos'"
        [attr.aria-label]="getFilterDescription('favoritos')">
        <div class="filter-icon favorites">
          <ion-icon name="heart"></ion-icon>
        </div>
        <span class="filter-label">Favoritos</span>
        <span class="filter-count" aria-hidden="true">{{ favoriteAdopciones.length }}</span>
      </button>
    </div>
  </div>

  <!-- Loading Mejorado -->
  <div class="loading-container" *ngIf="loadingAdopciones">
    <div class="loading-animation">
      <div class="paw-loader">
        <ion-icon name="paw" class="paw-1"></ion-icon>
        <ion-icon name="paw" class="paw-2"></ion-icon>
        <ion-icon name="paw" class="paw-3"></ion-icon>
      </div>
      <h3>Buscando amigos peludos...</h3>
      <p>Preparando las mejores opciones para ti</p>
    </div>
    
    <!-- Skeleton Grid Mejorado -->
    <ion-grid class="pet-grid skeleton-grid">
      <ion-row>
        <ion-col size="12" size-md="6" size-lg="4" *ngFor="let i of [1,2,3,4,5,6]">
          <div class="skeleton-card">
            <div class="skeleton-image">
              <ion-skeleton-text animated></ion-skeleton-text>
            </div>
            <div class="skeleton-content">
              <ion-skeleton-text animated style="width: 70%; height: 20px; margin-bottom: 8px;"></ion-skeleton-text>
              <ion-skeleton-text animated style="width: 50%; height: 16px; margin-bottom: 8px;"></ion-skeleton-text>
              <ion-skeleton-text animated style="width: 80%; height: 16px;"></ion-skeleton-text>
            </div>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <!-- Error Mejorado -->
  <div *ngIf="adopcionesError && !loadingAdopciones" class="enhanced-empty-state error">
    <div class="empty-icon">
        <ion-icon name="wifi-outline" color="warning"></ion-icon>
    </div>
    <h3>Oops, sin conexión</h3>
    <p>No pudimos cargar las mascotas. Revisa tu conexión e intenta nuevamente.</p>
    <ion-button 
      (click)="loadAdopciones()" 
      fill="outline" 
      color="primary">
      <ion-icon name="refresh" slot="start"></ion-icon>
      Intentar de nuevo
    </ion-button>
  </div>

  <!-- Estado Vacío Mejorado -->
  <div *ngIf="!loadingAdopciones && !adopcionesError && filteredAdopciones.length === 0" class="enhanced-empty-state">
    <div class="empty-icon">
      <ion-icon name="search" color="medium"></ion-icon>
    </div>
    <h3>No encontramos mascotas</h3>
    <p>Intenta ajustar tus filtros o explora otras categorías</p>
    <div class="empty-actions">
      <ion-button 
        (click)="clearAllFilters()" 
        fill="outline" 
        color="primary">
        <ion-icon name="refresh" slot="start"></ion-icon>
        Limpiar filtros
      </ion-button>
      <ion-button 
        (click)="crearAdopcion()" 
        fill="solid" 
        color="secondary">
        <ion-icon name="add" slot="start"></ion-icon>
        Publicar mascota
      </ion-button>
    </div>
  </div>

  <!-- Results Header -->
  <div class="results-header" *ngIf="!loadingAdopciones && !adopcionesError && filteredAdopciones.length > 0">
    <div class="results-info" aria-live="polite" aria-atomic="true">
      <h3>{{ getResultsTitle() }}</h3>
      <span class="results-count">{{ filteredAdopciones.length }} mascota{{ filteredAdopciones.length !== 1 ? 's' : '' }}</span>
      <span class="sr-only">{{ resultsAnnouncement }}</span>
    </div>
    <div class="view-options">
      <ion-segment [(ngModel)]="viewMode" (ionChange)="onViewModeChange()">
        <ion-segment-button value="grid">
          <ion-icon name="grid-outline"></ion-icon>
        </ion-segment-button>
        <ion-segment-button value="list">
          <ion-icon name="list-outline"></ion-icon>
        </ion-segment-button>
      </ion-segment>
    </div>
  </div>

  <!-- Pet Grid Mejorado -->
  <ion-grid 
    class="enhanced-pet-grid" 
    [class.list-view]="viewMode === 'list'"
    *ngIf="!loadingAdopciones && !adopcionesError && filteredAdopciones.length > 0">
    <ion-row>
      <ion-col 
        size="12" 
        [attr.size-md]="viewMode === 'list' ? '12' : '6'" 
        [attr.size-lg]="viewMode === 'list' ? '12' : '4'" 
        *ngFor="let adopcion of filteredAdopciones; trackBy: trackByAdopcionId">
        <div class="card-container" [@cardAnimation]>
          <app-card
            [nombre]="adopcion.nombre"
            [tipoMascota]="adopcion.tipoMascota"
            [etapaVida]="adopcion.etapaVida"
            [edadMeses]="adopcion.edadMeses"
            [edadAnios]="adopcion.edadAnios"
            [sexo]="adopcion.sexo"
            [tamano]="adopcion.tamano"
            [esterilizado]="adopcion.esterilizado"
            [descripcion]="adopcion.descripcion"
            [urlImagen]="adopcion.urlImagen"
            (detailsClicked)="onDetails(adopcion)"
            [creadorId]="adopcion.creadorId"
            [adopcionId]="adopcion.id"
            [isFavorite]="isAdopcionFavorite(adopcion.id)"
            [isFavoriteInFlight]="favoriteInFlight.has(adopcion.id)"
            [isVerified]="adopcion.isVerified"
            [location]="adopcion.location"
            [status]="adopcion.status"
            (toggleFavoriteEvent)="toggleFavorite(adopcion)"
            (reportEvent)="reportAdopcion(adopcion)"
            (confirmHandoverEvent)="irAEntrega($event)">
          </app-card>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- FAB para crear nueva adopción -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="!loadingAdopciones">
    <ion-fab-button 
      color="primary" 
      (click)="crearAdopcion()"
      title="Crear nueva adopción">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>


